[{"id":"e9cabb74.fe91","type":"tab","label":"OL Connect API","disabled":false,"info":""},{"id":"51790cbc.40d12c","type":"tab","label":"Health Dashboard","disabled":false,"info":""},{"id":"8fb980b3.1d7608","type":"tab","label":"temp (to be remove)","disabled":false,"info":""},{"id":"9d046ee7.fd5b38","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"676f881a.2970e","type":"mongodb-config","z":"","hostname":"127.0.0.1","port":"27017","db":"Test","name":"Test database"},{"id":"ba23399f.6256c8","type":"olc-server","z":"","host":"localhost","port":"9340","username":"ol-admin","password":"secret","name":"My Dev Server"},{"id":"93ad53ce.0a9168","type":"olc-server","z":"","host":"localhost","port":"9340","username":"ol-admin","password":"secret","name":"My Dev Server"},{"id":"793172d6.403c04","type":"ui_group","z":"","name":"Last refresh","tab":"31f79a51.af9836","disp":true,"width":"12","collapse":false},{"id":"31f79a51.af9836","type":"ui_tab","z":"","name":"Home","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"eca3b0d4.5b7868","type":"ui_group","z":"","name":"Group 1","tab":"33273e47.bcd172","order":1,"disp":false,"width":"6"},{"id":"33273e47.bcd172","type":"ui_tab","z":"","name":"switch test","icon":"dashboard","order":3},{"id":"8378d78.5c46728","type":"ui_group","z":"","name":"Memory","tab":"377f01b7.8869de","order":3,"disp":true,"width":"6"},{"id":"56329cc.047c7e4","type":"ui_group","z":"","name":"System Information","tab":"377f01b7.8869de","order":1,"disp":true,"width":"6"},{"id":"377f01b7.8869de","type":"ui_tab","z":"","name":"System","icon":"computer"},{"id":"24ff660a.29feda","type":"ui_group","z":"","name":"System Information","tab":"377f01b7.8869de","order":1,"disp":true,"width":"8","collapse":true},{"id":"ecfbd287.bb2578","type":"ui_group","z":"","name":"CPU Status","tab":"","order":2,"disp":true,"width":"8","collapse":true},{"id":"db5658b7.cb508","type":"ui_group","z":"","name":"Memory Status","tab":"","order":3,"disp":true,"width":"8","collapse":true},{"id":"dcb78f2d.54d3b8","type":"olc-server","z":"","host":"localhost","port":"9340","username":"ol-admin","password":"secret","name":"My Dev Server"},{"id":"58ab77d5.3bbc1","type":"olc-server","z":"","host":"localhost","port":"9340","username":"ol-admin","password":"secret","name":"My Dev Server"},{"id":"8472406d.86a92","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"objectiflune","tz":""},{"id":"82d2a688.93a028","type":"http request","z":"e9cabb74.fe91","name":"Upload File to FileStore","method":"POST","ret":"txt","paytoqs":false,"url":"http://localhost:9340/rest/serverengine/filestore/{{{path}}}?filename={{{bank}}}{{{file}}}&persistent=true","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":1600,"wires":[["b0bf0f07.8dba3"]]},{"id":"b1b664e0.8e99d8","type":"debug","z":"e9cabb74.fe91","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1030,"y":1600,"wires":[]},{"id":"c884120c.7f42b8","type":"debug","z":"e9cabb74.fe91","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"filename","targetType":"msg","x":650,"y":1760,"wires":[]},{"id":"e08a3881.c6fb88","type":"base64","z":"e9cabb74.fe91","name":"","action":"","property":"payload","x":1420,"y":560,"wires":[["a72c5cdc.fede4"]]},{"id":"e4014e2c.a36f8","type":"comment","z":"8fb980b3.1d7608","name":"Convert csv to json","info":"{\"RECORD\":\"000001\",\"CO\":\"F1657508.dc9\",\"LAYER\":\"DLY_DE_FR_00205_DUP.dot\",\"WCP\":3,\"CPF\":1,\"EMB4\":\"CARD 6703 7965 1141 6000 5 N5   \",\"UFM01\":\"MONSIEUR                043802\",\"UFM02\":\"CO COSSE BENOIT               \",\"UFM03\":\"RUE JACQUET             87    \",\"UFM04\":\"5580  ROCHEFORT               \",\"UFM07\":\"26 novembre 2019\",\"UFM11\":\"        BP/PB 1736    1000 BRU\",\"UFM95\":\"DC01047F74A5\",\"UFM99\":\"JJBEA129882005330352933\",\"UFM100\":\"|JJBEA129882005330352933�~ \",\"UFM901\":\"TBDTBD\",\"UFM902\":\"59995D1D5991D\"}\n","x":230,"y":100,"wires":[]},{"id":"86e81ca8.e697a","type":"inject","z":"8fb980b3.1d7608","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":180,"y":140,"wires":[["c845fcb0.7a5d48"]]},{"id":"c845fcb0.7a5d48","type":"file in","z":"8fb980b3.1d7608","name":"","filename":"C:/red/data/belfius/1_19112703_F1657508.MAI","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":440,"y":140,"wires":[["e340ed9.2245c1"]]},{"id":"fdf0f1f6.2d682","type":"csv","z":"8fb980b3.1d7608","name":"","sep":";","hdrin":true,"hdrout":"","multi":"one","ret":"\\n","temp":"","skip":"0","strings":true,"x":1030,"y":140,"wires":[["488489d1.78149"]]},{"id":"488489d1.78149","type":"debug","z":"8fb980b3.1d7608","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1170,"y":140,"wires":[]},{"id":"e340ed9.2245c1","type":"function","z":"8fb980b3.1d7608","name":"Get rid of linebreak inside double quote","func":"//Fix: if there are any line breaks in between column values, then that column value will be wrapped in double quotes\n//first get all the double quoted values list using regex\nvar lineBreakList = msg.payload.match(/([\"'])(\\\\?)[\\s\\S]*?\\1/g);\n//search for line breaks using regex, if found replace it with empty value\nlineBreakList.forEach(function (item) {\n    msg.payload = msg.payload.replace(item, item.replace(/\\r?\\n|\\r/g, '<br \\/>'));\n});\n\nreturn msg;","outputs":1,"noerr":0,"x":800,"y":140,"wires":[["fdf0f1f6.2d682"]]},{"id":"b0bf0f07.8dba3","type":"switch","z":"e9cabb74.fe91","name":"status code","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"neq","v":"200","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":870,"y":1600,"wires":[["eb0ae8da.5c91b"],["b1b664e0.8e99d8"]]},{"id":"eb0ae8da.5c91b","type":"debug","z":"e9cabb74.fe91","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1050,"y":1560,"wires":[]},{"id":"e3766387.db7f2","type":"http in","z":"e9cabb74.fe91","name":"","url":"/newrefreshback","method":"post","upload":false,"swaggerDoc":"","x":240,"y":600,"wires":[["1c459b29.13510d","89a4b04d.15d238"]],"info":"Example: http://127.0.0.1:1880/pod/render/site/dashboard\n\n/:solution/:verb/:template/:section\n\nMaps to\nmsg.req.params.solution\nmsg.req.params.verb\nmsg.req.params.template\nmsg.req.params.section"},{"id":"6e4db292.5c1a44","type":"http request","z":"e9cabb74.fe91","name":"Image preview","method":"POST","ret":"bin","paytoqs":false,"url":"http://localhost:9340/rest/serverengine/workflow/contentcreation/imagepreview/{{{template}}}","tls":"","persist":false,"proxy":"","authType":"basic","x":1020,"y":560,"wires":[["c8926362.86a63"]]},{"id":"c8926362.86a63","type":"switch","z":"e9cabb74.fe91","name":"status code","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"404","vt":"num"},{"t":"eq","v":"200","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1090,"y":620,"wires":[["3c9a4b78.14cbb4"],["e08a3881.c6fb88","862361d7.090908"]]},{"id":"3c9a4b78.14cbb4","type":"file in","z":"e9cabb74.fe91","name":"error.jpg","filename":"C:/red/error.jpg","format":"","chunk":false,"sendError":false,"encoding":"none","x":1220,"y":560,"wires":[["e08a3881.c6fb88"]]},{"id":"e0231524.908b68","type":"http response","z":"e9cabb74.fe91","name":"","statusCode":"200","headers":{"content-type":"text/html"},"x":1780,"y":600,"wires":[]},{"id":"a72c5cdc.fede4","type":"function","z":"e9cabb74.fe91","name":"prepend image","func":"msg.payload = \"data:image/jpg;base64, \" + msg.payload;\ndelete msg.template;\nreturn msg;","outputs":1,"noerr":0,"x":1600,"y":560,"wires":[["e0231524.908b68","3a5372b6.95354e"]]},{"id":"86cf772d.be8c48","type":"comment","z":"e9cabb74.fe91","name":"-------------------------------------------------------------- Rasterize ---------------------------------------------------------","info":"# Raster\ncall a Connect template and rasterize \nthen return a base 64 string","x":520,"y":380,"wires":[]},{"id":"862361d7.090908","type":"image","z":"e9cabb74.fe91","name":"","width":"200","data":"payload","dataType":"msg","thumbnail":false,"active":true,"x":1380,"y":620,"wires":[]},{"id":"2ab6e06b.8d40c","type":"file","z":"e9cabb74.fe91","name":"","filename":"c:\\temp\\lastjson.json","appendNewline":true,"createDir":false,"overwriteFile":"true","encoding":"utf8","x":1240,"y":480,"wires":[[]]},{"id":"6c201b13.43700c","type":"comment","z":"e9cabb74.fe91","name":"--------------------- For debug purpose ----------------","info":"","x":870,"y":680,"wires":[]},{"id":"6f21dae0.c1a004","type":"json","z":"e9cabb74.fe91","name":"","property":"payload","action":"","pretty":false,"x":910,"y":740,"wires":[["36b406e4.ae51c2"]]},{"id":"b0cb9f93.2caeb","type":"change","z":"e9cabb74.fe91","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.json","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":740,"wires":[["6f21dae0.c1a004"]]},{"id":"47584132.2f17f","type":"comment","z":"e9cabb74.fe91","name":"File store ID","info":"","x":1230,"y":1560,"wires":[]},{"id":"9eb2112f.c0b23","type":"comment","z":"e9cabb74.fe91","name":"Error file store","info":"","x":1230,"y":1600,"wires":[]},{"id":"4b33e1a0.61c46","type":"http in","z":"e9cabb74.fe91","name":"","url":"preview","method":"post","upload":false,"swaggerDoc":"","x":260,"y":840,"wires":[["1c459b29.13510d","446ac784.bea528"]]},{"id":"3332ecd0.f45074","type":"http response","z":"e9cabb74.fe91","name":"","statusCode":"200","headers":{"content-type":"application/pdf"},"x":1280,"y":1020,"wires":[]},{"id":"cf7f19e1.8049","type":"comment","z":"e9cabb74.fe91","name":"----------------------------------------------------- Serve HTML ressource  --------------------------------------------------","info":"","x":500,"y":1180,"wires":[]},{"id":"c9c60617.15294","type":"http in","z":"e9cabb74.fe91","name":"","url":"/corpo_message","method":"post","upload":false,"swaggerDoc":"","x":240,"y":1240,"wires":[["4f2a785d.585238","e07d5271.23d1c8"]],"info":"Example: http://127.0.0.1:1880/pod/render/site/dashboard\n\n/:solution/:verb/:template/:section\n\nMaps to\nmsg.req.params.solution\nmsg.req.params.verb\nmsg.req.params.template\nmsg.req.params.section"},{"id":"29708e21.496f12","type":"http response","z":"e9cabb74.fe91","name":"","statusCode":"200","headers":{"content-type":"text/html"},"x":1440,"y":1360,"wires":[]},{"id":"a01749c7.bcb838","type":"http in","z":"e9cabb74.fe91","name":"","url":"/tiny_test","method":"post","upload":false,"swaggerDoc":"","x":220,"y":1440,"wires":[["67017b3f.474e6c"]],"info":"Example: http://127.0.0.1:1880/pod/render/site/dashboard\n\n/:solution/:verb/:template/:section\n\nMaps to\nmsg.req.params.solution\nmsg.req.params.verb\nmsg.req.params.template\nmsg.req.params.section"},{"id":"4fad8be4.967c14","type":"file in","z":"e9cabb74.fe91","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"utf8","x":630,"y":1440,"wires":[["29708e21.496f12"]]},{"id":"3a5372b6.95354e","type":"ui_template","z":"e9cabb74.fe91","group":"793172d6.403c04","name":"","order":0,"width":0,"height":0,"format":"<img width=\"300px\" src=\"{{msg.payload}}\" />","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1800,"y":540,"wires":[[]]},{"id":"f586aea4.ec4ca8","type":"function","z":"e9cabb74.fe91","name":"data -> payload","func":"msg.payload = msg.payload.data;\nreturn msg;","outputs":1,"noerr":0,"x":1020,"y":480,"wires":[["2ab6e06b.8d40c"]]},{"id":"c833df11.d3bff8","type":"function","z":"e9cabb74.fe91","name":"IPv4 address","func":"// look up for the first IP v4 address\n\nfor (i = 0; i < msg.payload.networkInterfaces.Ethernet.length; i++) {\n    if (msg.payload.networkInterfaces.Ethernet[i].family == 'IPv4') {\n        msg.payload = msg.payload.networkInterfaces.Ethernet[i].address;\n        break;\n    }\n} \nmsg.topic = \"interface\";\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":1220,"wires":[["a1e88745.b1207"]]},{"id":"3bcfc563.c8143a","type":"OS","z":"51790cbc.40d12c","name":"","x":750,"y":660,"wires":[["5f455144.bc0f08","f4763abf.8cb18","cd57bfe5.65992","294ace08.867382"]]},{"id":"2233cb65.66d92c","type":"Uptime","z":"51790cbc.40d12c","name":"","x":761,"y":615,"wires":[["cf9df36a.57f2"]]},{"id":"f6cd8807.f07de8","type":"CPUs","z":"51790cbc.40d12c","name":"","x":430,"y":100,"wires":[["ec2219ac.163db8"]]},{"id":"541ad389.27c8fc","type":"Memory","z":"51790cbc.40d12c","name":"","x":820,"y":260,"wires":[["369ef251.d4b55e","de59b3ca.dd8dc8","ac3731e3.7a7948","379f5c7f.1e2964"]]},{"id":"a69a6d00.74a27","type":"inject","z":"51790cbc.40d12c","name":"update","topic":"","payload":"","payloadType":"date","repeat":"30","crontab":"","once":true,"onceDelay":"","x":94,"y":245,"wires":[["3bcfc563.c8143a","2233cb65.66d92c","f6cd8807.f07de8","541ad389.27c8fc"]]},{"id":"369ef251.d4b55e","type":"function","z":"51790cbc.40d12c","name":"","func":"msg.payload = msg.payload.memusage;\nreturn msg;","outputs":1,"noerr":0,"x":825,"y":428,"wires":[["3d09a3d7.88d964"]]},{"id":"3d09a3d7.88d964","type":"ui_gauge","z":"51790cbc.40d12c","name":"Memory Usage","group":"8378d78.5c46728","order":2,"width":0,"height":0,"gtype":"gage","title":"1 Minute","label":"Usage","format":"{{value | number:2}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"x":1009,"y":432,"wires":[]},{"id":"de59b3ca.dd8dc8","type":"function","z":"51790cbc.40d12c","name":"","func":"function formatBytes(bytes,decimals) {\n   if(bytes === 0) return '0 Byte';\n   var k = 1000; // or 1024 for binary\n   var dm = decimals + 1 || 3;\n   var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n   var i = Math.floor(Math.log(bytes) / Math.log(k));\n   return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\nmsg.payload = formatBytes(msg.payload.totalmem);\nreturn msg;","outputs":1,"noerr":0,"x":827,"y":471,"wires":[["c631b09d.f27ce"]]},{"id":"ac3731e3.7a7948","type":"function","z":"51790cbc.40d12c","name":"","func":"function formatBytes(bytes,decimals) {\n   if(bytes === 0) return '0 Byte';\n   var k = 1000; // or 1024 for binary\n   var dm = decimals + 1 || 3;\n   var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n   var i = Math.floor(Math.log(bytes) / Math.log(k));\n   return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];\n}\n\nmsg.payload = formatBytes(msg.payload.freemem);\nreturn msg;","outputs":1,"noerr":0,"x":825,"y":517,"wires":[["2726425a.e48c9e"]]},{"id":"c631b09d.f27ce","type":"ui_text","z":"51790cbc.40d12c","group":"8378d78.5c46728","order":3,"width":0,"height":0,"name":"","label":"Total Memory","format":"{{msg.payload}}","layout":"row-spread","x":1008,"y":475,"wires":[]},{"id":"2726425a.e48c9e","type":"ui_text","z":"51790cbc.40d12c","group":"8378d78.5c46728","order":4,"width":0,"height":0,"name":"","label":"Free Memory","format":"{{msg.payload}}","layout":"row-spread","x":1012,"y":518,"wires":[]},{"id":"cf9df36a.57f2","type":"function","z":"51790cbc.40d12c","name":"","func":"function timeConversion(millisec) {\n\n    var seconds = (millisec / 1000).toFixed(1);\n\n    var minutes = (millisec / (1000 * 60)).toFixed(1);\n\n    var hours = (millisec / (1000 * 60 * 60)).toFixed(1);\n\n    var days = (millisec / (1000 * 60 * 60 * 24)).toFixed(1);\n\n    if (seconds < 60) {\n        return seconds + \" Sec\";\n    } else if (minutes < 60) {\n        return minutes + \" Min\";\n    } else if (hours < 24) {\n        return hours + \" Hrs\";\n    } else {\n        return days + \" Days\"\n    }\n}\n\nmsg.payload = timeConversion(msg.payload.uptime * 1000);\nreturn msg;","outputs":1,"noerr":0,"x":922,"y":615,"wires":[["dbdf60f6.459118"]]},{"id":"dbdf60f6.459118","type":"ui_text","z":"51790cbc.40d12c","group":"56329cc.047c7e4","order":1,"width":0,"height":0,"name":"","label":"Uptime","format":"{{msg.payload}}","layout":"row-spread","x":1077,"y":614,"wires":[]},{"id":"5f455144.bc0f08","type":"function","z":"51790cbc.40d12c","name":"","func":"msg.payload = msg.payload.hostname;\nreturn msg;","outputs":1,"noerr":0,"x":921,"y":652,"wires":[["813ae4b.05c0598"]]},{"id":"813ae4b.05c0598","type":"ui_text","z":"51790cbc.40d12c","group":"56329cc.047c7e4","order":2,"width":0,"height":0,"name":"","label":"Hostname","format":"{{msg.payload}}","layout":"row-spread","x":1089,"y":654,"wires":[]},{"id":"f4763abf.8cb18","type":"function","z":"51790cbc.40d12c","name":"","func":"msg.payload = msg.payload.platform;\nreturn msg;","outputs":1,"noerr":0,"x":923,"y":690,"wires":[["deb09153.6bed28"]]},{"id":"deb09153.6bed28","type":"ui_text","z":"51790cbc.40d12c","group":"56329cc.047c7e4","order":3,"width":0,"height":0,"name":"","label":"Platform","format":"{{msg.payload}}","layout":"row-spread","x":1085,"y":693,"wires":[]},{"id":"cd57bfe5.65992","type":"function","z":"51790cbc.40d12c","name":"","func":"msg.payload = msg.payload.arch;\nreturn msg;","outputs":1,"noerr":0,"x":924,"y":729,"wires":[["4a90764e.16b9"]]},{"id":"4a90764e.16b9","type":"ui_text","z":"51790cbc.40d12c","group":"56329cc.047c7e4","order":4,"width":0,"height":0,"name":"","label":"Arch","format":"{{msg.payload}}","layout":"row-spread","x":1073,"y":733,"wires":[]},{"id":"294ace08.867382","type":"function","z":"51790cbc.40d12c","name":"","func":"msg.payload = msg.payload.release;\nreturn msg;","outputs":1,"noerr":0,"x":925,"y":765,"wires":[["94523c4.a7e5c4"]]},{"id":"94523c4.a7e5c4","type":"ui_text","z":"51790cbc.40d12c","group":"56329cc.047c7e4","order":5,"width":0,"height":0,"name":"","label":"Release","format":"{{msg.payload}}","layout":"row-spread","x":1085,"y":771,"wires":[]},{"id":"ec2219ac.163db8","type":"function","z":"51790cbc.40d12c","name":"","func":"msg.payload = msg.payload.cpus[0].model;\nreturn msg;","outputs":1,"noerr":0,"x":570,"y":100,"wires":[["c158cb18.d3bd5"]]},{"id":"c158cb18.d3bd5","type":"ui_text","z":"51790cbc.40d12c","group":"56329cc.047c7e4","order":6,"width":0,"height":0,"name":"","label":"CPU 1","format":"{{msg.payload}}","layout":"row-spread","x":710,"y":100,"wires":[]},{"id":"379f5c7f.1e2964","type":"function","z":"51790cbc.40d12c","name":"","func":"msg.payload = msg.payload.memusage;\nreturn msg;","outputs":1,"noerr":0,"x":822,"y":389,"wires":[["8189b1a7.25d3e"]]},{"id":"8189b1a7.25d3e","type":"ui_chart","z":"51790cbc.40d12c","name":"Memory - 24 Hours","group":"8378d78.5c46728","order":1,"width":0,"height":0,"label":"24 Hours","chartType":"line","legend":"false","xformat":"%H:%M:%S","interpolate":"linear","nodata":"","ymin":"","ymax":"","removeOlder":1,"removeOlderUnit":"86400","outputs":1,"x":1020,"y":392,"wires":[[]]},{"id":"a0ddd1aa.eeb3e","type":"comment","z":"51790cbc.40d12c","name":"Memory Usage","info":"","x":1005,"y":342,"wires":[]},{"id":"a4084b2.5cd3a38","type":"comment","z":"51790cbc.40d12c","name":"System Information","info":"","x":790,"y":560,"wires":[]},{"id":"e07d5271.23d1c8","type":"OS","z":"e9cabb74.fe91","name":"","x":450,"y":1260,"wires":[["643b3a0e.bb7c0c"]]},{"id":"643b3a0e.bb7c0c","type":"function","z":"e9cabb74.fe91","name":"hostname","func":"msg.payload = msg.payload.hostname;\nmsg.topic = \"host\";\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":1260,"wires":[["a1e88745.b1207"]]},{"id":"a1e88745.b1207","type":"join","z":"e9cabb74.fe91","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":830,"y":1240,"wires":[["58366c4d.df29ec"]]},{"id":"4f2a785d.585238","type":"NetworkIntf","z":"e9cabb74.fe91","name":"","x":470,"y":1220,"wires":[["c833df11.d3bff8"]]},{"id":"58366c4d.df29ec","type":"template","z":"e9cabb74.fe91","name":"Corpo Message","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!DOCTYPE html>\n<html>\n<body>\n\n<h1>OL Connect Server ({{payload.host}})</h1>\n    <p>\n    IP Address : {{payload.interface}} !\n    </p>\n</body>\n</html>","output":"str","x":1000,"y":1240,"wires":[["29708e21.496f12"]]},{"id":"9c8e0791.7a0e38","type":"ping","z":"51790cbc.40d12c","name":"google","host":"8.8.8.8","timer":"60","x":350,"y":1060,"wires":[["3f33b54e.8662ca"]]},{"id":"3f33b54e.8662ca","type":"ui_chart","z":"51790cbc.40d12c","name":"","group":"24ff660a.29feda","order":1,"width":0,"height":0,"label":"Ping time","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":"24","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":520,"y":1060,"wires":[[]]},{"id":"36b406e4.ae51c2","type":"debug","z":"e9cabb74.fe91","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1070,"y":740,"wires":[]},{"id":"345bf2b.987a70e","type":"mongodb-node","z":"8fb980b3.1d7608","mongodb":"676f881a.2970e","name":"store","collection":"gemalto","operation":"insert","upsert":false,"multi":false,"x":730,"y":280,"wires":[["732d5dd8.149f6c"]]},{"id":"5cd75285.598de4","type":"mongodb-node","z":"8fb980b3.1d7608","mongodb":"676f881a.2970e","name":"retrieve","collection":"gemalto","operation":"find","upsert":false,"multi":false,"x":740,"y":320,"wires":[["732d5dd8.149f6c"]]},{"id":"cf99bd7.f33f8c","type":"http in","z":"8fb980b3.1d7608","name":"web request","url":"/test/:uid/:action","method":"get","upload":false,"swaggerDoc":"","x":150,"y":320,"wires":[["1d7b3879.c23e6"]]},{"id":"732d5dd8.149f6c","type":"http response","z":"8fb980b3.1d7608","name":"Return","statusCode":"","headers":{},"x":930,"y":300,"wires":[]},{"id":"dbacaf29.9c5ce8","type":"function","z":"8fb980b3.1d7608","name":"Set value to store","func":"var value = msg.payload.value;\nmsg.payload = msg.req.params;\nmsg.payload.value = value;\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":280,"wires":[["345bf2b.987a70e"]]},{"id":"1d7b3879.c23e6","type":"switch","z":"8fb980b3.1d7608","name":"","property":"req.params.action","propertyType":"msg","rules":[{"t":"eq","v":"store","vt":"str"},{"t":"eq","v":"retrieve","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":330,"y":320,"wires":[["dbacaf29.9c5ce8"],["d86cf27a.9a5d38"]]},{"id":"d86cf27a.9a5d38","type":"function","z":"8fb980b3.1d7608","name":"set message","func":"msg.payload = { \"uid\" : msg.req.params.uid};\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":320,"wires":[["5cd75285.598de4"]]},{"id":"eacec356.94c3c8","type":"comment","z":"8fb980b3.1d7608","name":"Mongo DB test","info":"","x":200,"y":240,"wires":[]},{"id":"1c459b29.13510d","type":"function","z":"e9cabb74.fe91","name":"filter message","func":"if ( flow.get('debug')) {\n    return msg;\n} else {\n    return;\n}\n","outputs":1,"noerr":0,"x":540,"y":740,"wires":[["b0cb9f93.2caeb"]]},{"id":"a20e32e.66639d","type":"ui_switch","z":"e9cabb74.fe91","name":"","label":"Swirth Debug message","tooltip":"","group":"eca3b0d4.5b7868","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"switch","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":410,"y":2540,"wires":[["176bc471.689734"]]},{"id":"176bc471.689734","type":"function","z":"e9cabb74.fe91","name":"state","func":"var state = flow.get('debug') || false;\n\nif (msg.topic == 'switch') {\n    flow.set('debug', msg.payload);\n} \n\nmsg.payload = 'Debugging message is ' + (state ? 'on':'off');\nreturn msg;","outputs":1,"noerr":0,"x":610,"y":2540,"wires":[["65832348.7b95ac"]]},{"id":"65832348.7b95ac","type":"debug","z":"e9cabb74.fe91","name":"state","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":770,"y":2540,"wires":[]},{"id":"95f27411.4de0f","type":"inject","z":"e9cabb74.fe91","name":"on","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":"0.1","x":210,"y":2500,"wires":[["a20e32e.66639d"]]},{"id":"d6b3029b.0ac3f8","type":"inject","z":"e9cabb74.fe91","name":"off","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":"","x":210,"y":2560,"wires":[["a20e32e.66639d"]]},{"id":"6eecb365.dc3b5c","type":"comment","z":"e9cabb74.fe91","name":"----------------------------------------------------- Dashboard ----------------------------------------------","info":"","x":460,"y":2440,"wires":[]},{"id":"8f7cbca8.a87d9","type":"function","z":"e9cabb74.fe91","name":"set variable","func":"msg.template = encodeURIComponent(msg.payload.bank +msg.payload.oltemplate.acf.connect_template_name+'.ol-template');\nmsg.page = msg.payload.page;\nmsg.format = 'png';\nmsg.topic = 'refreshback';\nmsg.filename = flow.get(\"dataPath\") + '/'+ msg.payload.bank + '/' + msg.payload.oltemplate.acf.jsonfile;\nreturn msg;\n","outputs":1,"noerr":0,"x":530,"y":520,"wires":[["af602628.d670c"]]},{"id":"89a4b04d.15d238","type":"change","z":"e9cabb74.fe91","name":"","rules":[{"t":"set","p":"WPdata","pt":"msg","to":"payload.json","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.json","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":440,"y":440,"wires":[["5fd844ba.eed01c"]]},{"id":"5fd844ba.eed01c","type":"json","z":"e9cabb74.fe91","name":"","property":"payload","action":"","pretty":false,"x":470,"y":480,"wires":[["8f7cbca8.a87d9"]]},{"id":"af602628.d670c","type":"file in","z":"e9cabb74.fe91","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":570,"y":560,"wires":[["629bfb1a.2e99a4"]]},{"id":"629bfb1a.2e99a4","type":"json","z":"e9cabb74.fe91","name":"","property":"payload","action":"","pretty":false,"x":650,"y":620,"wires":[["c8ffbf46.20557"]]},{"id":"c8ffbf46.20557","type":"function","z":"e9cabb74.fe91","name":"set variable","func":"msg.payload = {data: msg.payload, pages: msg.page, format: msg.format};\nmsg.payload.data.WPdata = msg.WPdata;\nreturn msg;\n","outputs":1,"noerr":0,"x":810,"y":520,"wires":[["f586aea4.ec4ca8","6e4db292.5c1a44"]]},{"id":"9b3a75ec.7f3e18","type":"function","z":"e9cabb74.fe91","name":"set variables","func":"msg.topic = 'preview';\n// set template\nmsg.template = encodeURIComponent(msg.payload.bank +msg.payload.oltemplate.acf.connect_template_name+'.ol-template');\n// set datafile\nmsg.filename = flow.get(\"dataPath\") + '/'+ msg.payload.bank + '/' + msg.payload.oltemplate.acf.datafile;\nreturn msg;\n","outputs":1,"noerr":0,"x":570,"y":920,"wires":[["96fce900.6772b"]]},{"id":"446ac784.bea528","type":"change","z":"e9cabb74.fe91","name":"WPdata","rules":[{"t":"set","p":"WPdata","pt":"msg","to":"payload.json","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload.json","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":840,"wires":[["9a433ce5.f86ad"]]},{"id":"9a433ce5.f86ad","type":"json","z":"e9cabb74.fe91","name":"WPdata to JSON in payload","property":"payload","action":"","pretty":false,"x":560,"y":880,"wires":[["9b3a75ec.7f3e18"]]},{"id":"96fce900.6772b","type":"file in","z":"e9cabb74.fe91","name":"load data file","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":610,"y":960,"wires":[["e7f9c550.b61838"]]},{"id":"e7f9c550.b61838","type":"json","z":"e9cabb74.fe91","name":"bufffer to JSON","property":"payload","action":"","pretty":false,"x":680,"y":1020,"wires":[["cf8e5c89.fa359"]]},{"id":"cf8e5c89.fa359","type":"function","z":"e9cabb74.fe91","name":"set more variables","func":"\n//move payload into data\nmsg.payload = {data : msg.payload};\n// insert WPdata payload in the data\n\nif (Array.isArray(msg.payload.data)) {\nfor (i = 0; i < msg.payload.data.length; i++) {\n        msg.payload.data[i].WPdata = msg.WPdata;\n    }   \n} else {\n    msg.payload.data.WPdata = msg.WPdata;\n}\nmsg.jobinfos = {template : msg.template};\nreturn msg;\n","outputs":1,"noerr":0,"x":830,"y":840,"wires":[["89277eba.d36d58"]]},{"id":"e5eb87aa.3ddb8","type":"olc-create-job","z":"e9cabb74.fe91","server":"ba23399f.6256c8","jobpreset":"default.OL-jobpreset","name":"","x":970,"y":1000,"wires":[["5ddf23e4.5b8cfc"]]},{"id":"5ddf23e4.5b8cfc","type":"olc-create-output","z":"e9cabb74.fe91","server":"ba23399f.6256c8","outputpreset":"default.OL-outputpreset","name":"","x":1020,"y":1040,"wires":[["7497cf77.f2ad68"]]},{"id":"89277eba.d36d58","type":"http request","z":"e9cabb74.fe91","name":"content creation","method":"POST","ret":"bin","paytoqs":false,"url":"http://localhost:9340/rest/serverengine/workflow/contentcreation/{{{template}}}","tls":"","persist":false,"proxy":"","authType":"basic","x":860,"y":880,"wires":[["89b44d2a.4def48"]]},{"id":"3219b803.33c3d8","type":"http request","z":"e9cabb74.fe91","name":"get results","method":"POST","ret":"bin","paytoqs":false,"url":"http://localhost:9340/rest/serverengine/workflow/contentcreation/getResult/{{{operationId}}}","tls":"","persist":false,"proxy":"","authType":"basic","x":930,"y":960,"wires":[["e5eb87aa.3ddb8"]]},{"id":"89b44d2a.4def48","type":"function","z":"e9cabb74.fe91","name":"operationid","func":"msg.operationId = msg.headers.operationid;\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":920,"wires":[["3219b803.33c3d8"]]},{"id":"87a0012b.256b7","type":"file in","z":"e9cabb74.fe91","name":"load file","filename":"","format":"","chunk":false,"sendError":false,"encoding":"utf8","x":1180,"y":900,"wires":[["7dacccfd.fd6e1c"]]},{"id":"7497cf77.f2ad68","type":"change","z":"e9cabb74.fe91","name":"Set Filename","rules":[{"t":"set","p":"filename","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1150,"y":860,"wires":[["87a0012b.256b7"]]},{"id":"7dacccfd.fd6e1c","type":"base64","z":"e9cabb74.fe91","name":"","action":"","property":"payload","x":1200,"y":940,"wires":[["54874bfa.4ab414"]]},{"id":"54874bfa.4ab414","type":"function","z":"e9cabb74.fe91","name":"prepend application/pdf","func":"msg.payload = \"data:application/pdf;base64,\" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":980,"wires":[["3332ecd0.f45074"]]},{"id":"2c5984d5.4c688c","type":"template","z":"e9cabb74.fe91","name":"Drag and drop","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<body>\n<div id=\"drop-area\">\n\t<form class=\"my-form\" method=\"post\" enctype=\"multipart/form-data\">\n\t\t<p>Upload files with the file dialog or by dragging and dropping template, datamap, data file (JSON, MAI) onto the dashed region</p>\n  \t\t<input type=\"hidden\" name=\"ted_upload_action\" value=\"upload\">\n\t\t<input type=\"file\" id=\"ted_upload\" name=\"ted_upload\" accept=\".ol-template,.ol-datamapper,.mai,.json\">\n\t\t<a class=\"button\"><label class=\"button\" for=\"ted_upload\">Select files</label></a>\n  \t\t<button id=\"upload_submit\" type=\"submit\">\".__('Upload','theme').\"</button>\n\t</form>\n</div>\n</body>\n","output":"str","x":440,"y":1320,"wires":[["29708e21.496f12"]]},{"id":"318bef23.160f08","type":"http in","z":"e9cabb74.fe91","name":"","url":"/ted_drop","method":"post","upload":false,"swaggerDoc":"","x":220,"y":1320,"wires":[["2c5984d5.4c688c"]],"info":"Example: http://127.0.0.1:1880/pod/render/site/dashboard\n\n/:solution/:verb/:template/:section\n\nMaps to\nmsg.req.params.solution\nmsg.req.params.verb\nmsg.req.params.template\nmsg.req.params.section"},{"id":"61c3233f.b47794","type":"comment","z":"e9cabb74.fe91","name":"","info":"","x":260,"y":1120,"wires":[]},{"id":"cb48c9b5.647bf","type":"http in","z":"e9cabb74.fe91","name":"","url":"/upload","method":"post","upload":false,"swaggerDoc":"","x":210,"y":1560,"wires":[["33a78e30.911192","4a8d401.76af0c"]],"info":"Example: http://127.0.0.1:1880/pod/render/site/dashboard\n\n/:solution/:verb/:template/:section\n\nMaps to\nmsg.req.params.solution\nmsg.req.params.verb\nmsg.req.params.template\nmsg.req.params.section"},{"id":"a6abf67f.c75178","type":"http request","z":"e9cabb74.fe91","name":"","method":"GET","ret":"bin","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":310,"y":1640,"wires":[["94ba04f.1a8f278"]]},{"id":"33a78e30.911192","type":"function","z":"e9cabb74.fe91","name":"set url","func":"var msg1 ={\n    url: msg.payload.url,\n    type: msg.payload.type,\n    original_name: msg.payload.original_name,\n    size: msg.payload.size,\n    bank: msg.payload.bank\n}\nreturn msg1;","outputs":1,"noerr":0,"x":270,"y":1600,"wires":[["a6abf67f.c75178"]]},{"id":"6a0e87c4.d5666","type":"file","z":"e9cabb74.fe91","name":"","filename":"","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":630,"y":1720,"wires":[[]]},{"id":"94ba04f.1a8f278","type":"function","z":"e9cabb74.fe91","name":"Get Extension","func":"// Extract the file extension and name of the resource.\nmsg.file = encodeURIComponent( msg.original_name );\nmsg.ext = msg.original_name.split('.').pop(); // extract ext from filename\ndelete msg.url; // use the one in the next node\n\nnode.status({fill:\"blue\",shape:\"dot\",text: msg.ext });\n\nswitch(msg.ext.toLowerCase())\n{\n    case 'ol-template':\n        msg.path = 'template';\n        return [ msg, null ];\n    case 'ol-datamapper':\n        msg.path = 'DataMiningConfig';\n        return [ msg, null ];\n    case 'data':\n    case 'mai':\n        msg.filename = flow.get(\"dataPath\") + '/'+ msg.bank + '/' + msg.original_name;\n        \n        return [ null, msg ];\n    default:\n        return;\n}\n","outputs":2,"noerr":0,"x":380,"y":1680,"wires":[["82d2a688.93a028"],["c884120c.7f42b8","6a0e87c4.d5666"]]},{"id":"726c1ca.1d3ffe4","type":"comment","z":"e9cabb74.fe91","name":"---------- WP drop resources to the Connect File Store ----------------------------","info":"asdfasdf","x":410,"y":1500,"wires":[]},{"id":"3d37017b.9ec1e6","type":"comment","z":"e9cabb74.fe91","name":"Data file","info":"","x":640,"y":1680,"wires":[]},{"id":"4a8d401.76af0c","type":"function","z":"e9cabb74.fe91","name":"OK","func":"msg.payload = 'OK';\nreturn msg;\n","outputs":1,"noerr":0,"x":650,"y":1560,"wires":[["29708e21.496f12"]]},{"id":"477d3331.3a70cc","type":"comment","z":"8fb980b3.1d7608","name":"Aggregator pattern","info":"","x":290,"y":480,"wires":[]},{"id":"4d39c492.c365cc","type":"function","z":"8fb980b3.1d7608","name":"payload=451","func":"msg.payload = 451;\n\nreturn msg;","outputs":1,"noerr":0,"x":573.8332901000977,"y":563.5001125335693,"wires":[["5dff0249.9afc94"]]},{"id":"5dff0249.9afc94","type":"function","z":"8fb980b3.1d7608","name":"Calculate Sum","func":"// Reduce the number of inputs\ncontext.global.n--;\n\n// Store the data in msg.payload for all operations as they complete\ncontext.global.data[context.global.n] = msg.payload;\n\n// When all operations are complete calculate the sum and return\nif (context.global.n === 0)\n{   // Calculate the total value\n    var sum = 0;\n    for (var i = 0; i < context.global.data.length; i++)\n    {\n        sum += context.global.data[i];\n    }\n    msg.payload = sum;\n\n    return msg;\n}","outputs":1,"noerr":0,"x":768.8333435058594,"y":586.5001354217529,"wires":[["f851ce0.50851b"]]},{"id":"c4d48f17.af0f3","type":"function","z":"8fb980b3.1d7608","name":"payload=326","func":"msg.payload = 326;\n\nreturn msg;","outputs":1,"noerr":0,"x":572.8333129882812,"y":611.5001249313354,"wires":[["5dff0249.9afc94"]]},{"id":"f851ce0.50851b","type":"debug","z":"8fb980b3.1d7608","name":"Returns 777","active":true,"console":"false","complete":"payload","x":950.8333206176758,"y":586.5001230239868,"wires":[]},{"id":"bbc5bc34.7e1168","type":"function","z":"8fb980b3.1d7608","name":"Combine 2 Functions","func":"context.global.n = 2;\ncontext.global.data = new Array(2);\n\nreturn msg;","outputs":1,"noerr":0,"x":369.83331298828125,"y":588.5001220703125,"wires":[["4d39c492.c365cc","c4d48f17.af0f3"]]},{"id":"bb21407b.a9bc1","type":"comment","z":"8fb980b3.1d7608","name":"↓ 1st value","info":"","x":572.5798034667969,"y":525.0741882324219,"wires":[]},{"id":"de6e9bf2.5897a","type":"inject","z":"8fb980b3.1d7608","name":"Calculate the sum of 2 numbers","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":329.8893585205078,"y":524.1932220458984,"wires":[["bbc5bc34.7e1168"]]},{"id":"df417d2e.352dd8","type":"comment","z":"8fb980b3.1d7608","name":"↑ 2nd value","info":"","x":571.4131546020508,"y":652.0741004943848,"wires":[]},{"id":"901895c.9980fe8","type":"comment","z":"8fb980b3.1d7608","name":"Define how many parallel operations ↑","info":"","x":319.3417053222656,"y":631.62158203125,"wires":[]},{"id":"82baabd6.32ac28","type":"comment","z":"8fb980b3.1d7608","name":"↑ Once all parallel operations complete, calculate sum","info":"","x":855.9132080078125,"y":628.907470703125,"wires":[]},{"id":"1ad92b2.773fb55","type":"mysql","z":"e9cabb74.fe91","mydb":"8472406d.86a92","name":"objectiflune","x":570,"y":1980,"wires":[["403aadde.78db24"]]},{"id":"8b2f8504.bd4df8","type":"change","z":"e9cabb74.fe91","name":"managedfile","rules":[{"t":"set","p":"topic","pt":"msg","to":"SELECT * FROM objectiflune.managedfile WHERE DATECREATED = \"9999-10-09 00:00:00\"","tot":"str"},{"t":"set","p":"bank","pt":"msg","to":"payload.bank","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":1980,"wires":[["1ad92b2.773fb55"]]},{"id":"403aadde.78db24","type":"function","z":"e9cabb74.fe91","name":"select only template","func":"let templates = [];\nfor (i = 0; i < msg.payload.length; i++) {\n    var template = msg.payload[i].NAME;\n    if (template.toLowerCase().includes(\"ol-template\")) {\n        if (template.startsWith(msg.bank)) {\n            template = template.slice(msg.bank.length); //remove bank name\n            templates.push(template.slice(0, -12)); // remove remove .ol-template\n        }\n    }\n} \nmsg.payload = templates;\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":1980,"wires":[["93660c35.66da68"]]},{"id":"83c79a09.02c08","type":"http in","z":"e9cabb74.fe91","name":"","url":"/templates","method":"get","upload":false,"swaggerDoc":"","x":230,"y":1980,"wires":[["8b2f8504.bd4df8"]]},{"id":"635cb2cb.e481cc","type":"comment","z":"e9cabb74.fe91","name":"-------------- get template for specific bank in the file store","info":"","x":360,"y":1940,"wires":[]},{"id":"12953a8.38479c6","type":"mysql","z":"e9cabb74.fe91","mydb":"8472406d.86a92","name":"objectiflune","x":570,"y":2060,"wires":[["b6fe30d2.e368e"]]},{"id":"6d7d80c8.14518","type":"change","z":"e9cabb74.fe91","name":"managedfile","rules":[{"t":"set","p":"topic","pt":"msg","to":"SELECT * FROM objectiflune.managedfile WHERE DATECREATED = \"9999-10-09 00:00:00\"","tot":"str"},{"t":"set","p":"bank","pt":"msg","to":"payload.bank","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":2060,"wires":[["12953a8.38479c6"]]},{"id":"b6fe30d2.e368e","type":"function","z":"e9cabb74.fe91","name":"select only datamap","func":"let templates = [];\nfor (i = 0; i < msg.payload.length; i++) {\n    var template = msg.payload[i].NAME;\n    if (template.toLowerCase().includes(\"ol-datamapper\")) {\n        if (template.startsWith(msg.bank)) {\n            template = template.slice(msg.bank.length); //remove bank name\n            templates.push(template.slice(0, -14)); // remove remove .ol-datamap\n        }\n    }\n} \nmsg.payload = templates;\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":2060,"wires":[["93660c35.66da68"]]},{"id":"f4577123.27da","type":"http in","z":"e9cabb74.fe91","name":"","url":"/datamaps","method":"get","upload":false,"swaggerDoc":"","x":230,"y":2060,"wires":[["6d7d80c8.14518"]]},{"id":"93660c35.66da68","type":"http response","z":"e9cabb74.fe91","name":"","statusCode":"200","headers":{"content-type":"application/json"},"x":1120,"y":2140,"wires":[]},{"id":"30237b52.494c7c","type":"comment","z":"e9cabb74.fe91","name":"-------------- get datamapfor specific bank in the file store","info":"","x":360,"y":2020,"wires":[]},{"id":"198cd36.03b162d","type":"config","z":"e9cabb74.fe91","name":"Alienware config","properties":[{"p":"dataPath","pt":"flow","to":"C:/node/data","tot":"str"},{"p":"server","pt":"flow","to":"Alienware","tot":"str"},{"p":"resourcePath","pt":"flow","to":"C:/wamp64/www/gemalto/wp-content/themes/Document-Assembly","tot":"str"}],"active":true,"x":960,"y":200,"wires":[]},{"id":"4956511c.0426c8","type":"config","z":"e9cabb74.fe91","name":"Azure config","properties":[{"p":"dataPath","pt":"flow","to":"G:/node/data","tot":"str"},{"p":"server","pt":"flow","to":"azure","tot":"str"},{"p":"resourcePath","pt":"flow","to":"G:/Gemalto/red/Document-Assembly","tot":"str"}],"active":true,"x":950,"y":240,"wires":[]},{"id":"9294d66e.de8f1","type":"inject","z":"e9cabb74.fe91","name":"On startup","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":250,"y":220,"wires":[["5892b00c.848bd8"]]},{"id":"4980601f.df92b","type":"comment","z":"e9cabb74.fe91","name":"-------------------------------------------- Initialize a few flow variable depending on server we are running on ---------------------------------------------------------","info":"","x":660,"y":120,"wires":[]},{"id":"5892b00c.848bd8","type":"OS","z":"e9cabb74.fe91","name":"","x":410,"y":220,"wires":[["5175132e.a9ebec","c1401621.58d128"]]},{"id":"5175132e.a9ebec","type":"switch","z":"e9cabb74.fe91","name":"switch on hostname","property":"payload.hostname","propertyType":"msg","rules":[{"t":"eq","v":"Alienware","vt":"str"},{"t":"eq","v":"olsaas1-olc1","vt":"str"}],"checkall":"false","repair":false,"outputs":2,"x":620,"y":220,"wires":[["198cd36.03b162d"],["4956511c.0426c8"]]},{"id":"8d5d0aea.128d8","type":"inject","z":"e9cabb74.fe91","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":260,"y":320,"wires":[["3d2d28cc.2d04"]]},{"id":"fe4b3a8a.373548","type":"debug","z":"e9cabb74.fe91","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":730,"y":320,"wires":[]},{"id":"3d2d28cc.2d04","type":"function","z":"e9cabb74.fe91","name":"","func":"msg.payload =flow.get(\"resourcePath\");\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":320,"wires":[["fe4b3a8a.373548"]]},{"id":"c1401621.58d128","type":"debug","z":"e9cabb74.fe91","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":580,"y":280,"wires":[]},{"id":"67017b3f.474e6c","type":"function","z":"e9cabb74.fe91","name":"filename -> templateEditor","func":"msg.filename = flow.get(\"resourcePath\") +'/templateEditor.html';\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":1440,"wires":[["4fad8be4.967c14"]]},{"id":"34eefa48.d679f6","type":"http in","z":"e9cabb74.fe91","name":"","url":"/datas","method":"get","upload":false,"swaggerDoc":"","x":210,"y":2140,"wires":[["384ffc4.d1c7c84"]]},{"id":"5b5df60c.9d7e48","type":"comment","z":"e9cabb74.fe91","name":"-------------- get data file from directory","info":"","x":300,"y":2100,"wires":[]},{"id":"8e4817ad.337ec8","type":"inject","z":"e9cabb74.fe91","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":2220,"wires":[["db1a0210.d3414"]]},{"id":"384ffc4.d1c7c84","type":"function","z":"e9cabb74.fe91","name":"dataPath","func":"msg.path = flow.get(\"dataPath\") + '/'+ msg.payload.bank;\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":2140,"wires":[["29058fb2.80fa2"]]},{"id":"db1a0210.d3414","type":"function","z":"e9cabb74.fe91","name":"BELFIUS","func":"msg.payload = {bank: 'BELFIUS_'};\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":2220,"wires":[[]]},{"id":"29058fb2.80fa2","type":"fs-ops-dir","z":"e9cabb74.fe91","name":"*.data","path":"path","pathType":"msg","filter":"*.data","filterType":"str","dir":"payload","dirType":"msg","x":530,"y":2140,"wires":[["93660c35.66da68"]]},{"id":"cc0926bd.1cc008","type":"zip","z":"e9cabb74.fe91","name":"unzip","mode":"decompress","filename":"","outasstring":false,"x":530,"y":1860,"wires":[["83f6556f.787498"]]},{"id":"9db6e6a.e622f98","type":"file in","z":"e9cabb74.fe91","name":"load template","filename":"C:/red/upload/basev1.OL-template","format":"","chunk":false,"sendError":false,"encoding":"none","x":380,"y":1860,"wires":[["cc0926bd.1cc008"]]},{"id":"3d404a5.650b2b6","type":"inject","z":"e9cabb74.fe91","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":220,"y":1860,"wires":[["9db6e6a.e622f98"]]},{"id":"a5d685e6.c2f57","type":"debug","z":"e9cabb74.fe91","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1350,"y":1940,"wires":[]},{"id":"83f6556f.787498","type":"function","z":"e9cabb74.fe91","name":"find index.xml","func":"var index = msg.payload.find(obj => obj.filename == 'index.xml');\nif (index) {\n    var b=Buffer.from(index.payload);\n    return {payload: b.toString()}\n} else {\n    return;\n}\n","outputs":1,"noerr":0,"x":700,"y":1860,"wires":[["35bfe68f.d8749a"]]},{"id":"35bfe68f.d8749a","type":"xml","z":"e9cabb74.fe91","name":"","property":"payload","attr":"","chr":"","x":870,"y":1860,"wires":[["a31f112e.4d5318","30f97d7e.f7fb52"]]},{"id":"a31f112e.4d5318","type":"change","z":"e9cabb74.fe91","name":"sections","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.package.manifest[0].sections[0].section","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1100,"y":1800,"wires":[["a5d685e6.c2f57"]]},{"id":"30f97d7e.f7fb52","type":"change","z":"e9cabb74.fe91","name":"script","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload.package.scripts[0].script","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1090,"y":1860,"wires":[["a5d685e6.c2f57"]]}]